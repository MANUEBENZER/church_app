{% extends "base.html" %}
{% block title %}Daily Announcements & Report{% endblock %}
{% load static %}
{% load role_tags %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/announcements_dashboard.css' %}">
<script src="{% static 'js/promise.js' %}"></script>

<div class="page-header">
    <h2>ðŸ“¢ Daily Announcements & Service Report</h2>
    <p>{{ today|date:"F d, Y" }}</p>
</div>

<div class="dashboard-container">
    <!-- Attendance Summary -->
    <div class="attendance-summary card">
        <h3>Attendance Summary</h3>
        <ul>
            <li>Total Members: {{ attendance_summary.total_members }}</li>
            <li>Present: {{ attendance_summary.total_present }}</li>
            <li>Absent: {{ attendance_summary.total_absent }}</li>
        </ul>
    </div>

    <!-- Daily Report Form -->
    <form method="post" class="report-form card">
        {% csrf_token %}
        <h3>Daily Report</h3>
        <div class="form-group">
            <label>Service Type:</label>
            <select name="service_type">
                <option value="Sunday" {% if report.service_type == "Sunday" %}selected{% endif %}>Sunday</option>
                <option value="Midweek" {% if report.service_type == "Midweek" %}selected{% endif %}>Midweek</option>
            </select>
        </div>
        <div class="form-group">
            <label>Announcements:</label>
            <textarea name="announcements" rows="3">{{ report.announcements }}</textarea>
        </div>
        <div class="form-group">
            <label>Offering Amount:</label>
            <input type="number" name="offering_amount" value="{{ report.offering_amount }}" step="0.01">
        </div>
        <div class="form-group">
            <label>Promises Amount:</label>
            <input type="number" name="promises_amount" value="{{ report.promises_amount }}" step="0.01">
        </div>
        <div class="form-group">
            <label>Special Notes:</label>
            <textarea name="special_notes" rows="2">{{ report.special_notes }}</textarea>
        </div>
        <button type="submit" class="btn-primary">Save Report</button>
    </form>

    <!-- Promises Table -->
    <div class="card">
        <h3>Today's Promises</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Member</th>
                    <th>Photo</th>
                    <th>Type</th>
                    <th>Amount</th>
                    <th>Item</th>
                    <th>Due Date</th>
                </tr>
            </thead>
            <tbody>
                {% for promise in promises %}
                <tr>
                    <td>{{ promise.member_name }}</td>
                    <td>
                        {% if promise.member.photo %}
                            <img src="{{ promise.member.photo.url }}" alt="{{ promise.member_name }}" class="member-thumbnail">
                        {% else %}
                            <img src="{% static 'images/default_profile.png' %}" alt="No Photo" class="member-thumbnail">
                        {% endif %}
                    </td>
                    <td>{{ promise.get_promise_type_display }}</td>
                    <td>{% if promise.promise_type == 'money' %}{{ promise.amount }}{% else %}â€”{% endif %}</td>
                    <td>{% if promise.promise_type == 'item' %}{{ promise.item_description }}{% else %}â€”{% endif %}</td>
                    <td>{{ promise.due_date|date:"M d, Y" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">No promises recorded</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Add New Promise -->
    <form method="post" class="promise-form card">
        {% csrf_token %}
        <h3>Add New Promise</h3>
        <div class="form-group">
            <label>Member Name:</label>
            <div class="member-input">
                <input type="text" name="member_name" required placeholder="Start typing member name...">
                <img src="{% static 'images/default_profile.png' %}" alt="Member Photo" class="member-thumbnail-small">
            </div>
        </div>
        <div class="form-group">
            <label>Type:</label>
            <select name="promise_type" required>
                <option value="money">Money</option>
                <option value="item">Item</option>
            </select>
        </div>
        <div class="form-group">
            <label>Amount (if money):</label>
            <input type="number" name="amount" step="0.01">
        </div>
        <div class="form-group">
            <label>Item Description (if item):</label>
            <input type="text" name="item">
        </div>
        <div class="form-group">
            <label>Due Date:</label>
            <input type="date" name="promise_due_date">
        </div>
        <button type="submit" class="btn-primary">Add Promise</button>
    </form>
</div>

<p class="meta">
    Last updated: {{ report.updated_on }}<br>
    By: {{ report.created_by }}
</p>

{% endblock %}
